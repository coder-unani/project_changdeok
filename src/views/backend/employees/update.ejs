<div class="my-2">
  <h1 class="flex items-baseline justify-between gap-1.5 py-2 text-center text-slate-700 transition-all">
    <span class="orb-head"><%=title%></span>
    <p class="orb-label text-right"><span class="pr-0.5 text-red-500">*</span>필수입력사항</p>
  </h1>
</div>

<form id="formEmployeeModify">
  <div
    class="bg-default-bg mb-4 space-y-4 rounded-xl p-4 text-sm text-gray-800 shadow-[0_2px_30px_rgba(0,0,0,.06)] lg:p-6"
  >
    <div>
      <label for="email" class="orb-label mb-2 block">이메일<span class="pl-0.5 text-red-500">*</span></label>
      <p
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
      >
        <%=data.email%>
      </p>
    </div>

    <div>
      <label for="name" class="orb-label mb-2 block">이름<span class="pl-0.5 text-red-500">*</span></label>
      <input
        type="text"
        id="name"
        name="name"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.name%>"
        placeholder="이름을 입력해주세요."
        required
      />
    </div>

    <div>
      <label for="phone" class="orb-label mb-2 block">전화번호</label>
      <input
        type="text"
        id="phone"
        name="phone"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.phone%>"
        placeholder="전화번호를 입력해주세요."
      />
    </div>

    <div>
      <label for="mobile" class="orb-label mb-2 block">휴대전화</label>
      <input
        type="text"
        id="mobile"
        name="mobile"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.mobile%>"
        placeholder="휴대전화 번호를 입력해주세요."
      />
    </div>

    <div>
      <label for="address" class="orb-label mb-2 block">주소</label>
      <input
        type="text"
        id="address"
        name="address"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.address%>"
        placeholder="주소를 입력해주세요."
      />
    </div>

    <div>
      <label for="birthDate" class="orb-label mb-2 block">생년월일</label>
      <input
        type="date"
        id="birthDate"
        name="birthDate"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.birthDate%>"
      />
    </div>

    <div>
      <label for="position" class="orb-label mb-2 block">직급</label>
      <input
        type="text"
        id="position"
        name="position"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.position%>"
        placeholder="직급을 입력해주세요."
      />
    </div>

    <div>
      <label for="description" class="orb-label mb-2 block">설명</label>
      <input
        type="text"
        id="description"
        name="description"
        class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
        value="<%=data.description%>"
        placeholder="설명을 입력해주세요."
      />
    </div>

    <div class="flex gap-3 lg:gap-4">
      <div class="flex-1">
        <label for="hireDate" class="orb-label mb-2 block">입사일</label>
        <input
          type="date"
          id="hireDate"
          name="hireDate"
          class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
          value="<%=data.hireDate%>"
        />
      </div>

      <div class="flex-1">
        <label for="hireDate" class="orb-label mb-2 block">퇴사일</label>
        <input
          type="date"
          id="fireDate"
          name="fireDate"
          class="w-full rounded-lg bg-gray-100 px-4 py-3 placeholder:text-sm placeholder:text-gray-400 focus:ring-2 focus:ring-blue-200 focus:outline-none"
          value="<%=data.fireDate%>"
        />
      </div>
    </div>
  </div>

  <div class="flex justify-end">
    <button type="submit" class="orb-btn orb-btn-primary">수정</button>
  </div>
</form>

<!-- toastify -->
<%- include('../common/library/toastify') %>

<!-- sweetalert2 -->
<%- include('../common/library/sweetalert2') %>

<script nonce="<%=nonce%>">
  document.getElementById('formEmployeeModify').addEventListener('submit', async function (event) {
    event.preventDefault();

    // 폼 데이터 수집
    const formData = new FormData(this);

    // 폼 데이터 변환
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });

    try {
      // 직원 수정 API 호출
      const apiUrl = '<%=apiRoutes.employees.update.url%>'.replace(':employeeId', '<%=data.id%>');
      const response = await fetch(apiUrl, {
        method: '<%=apiRoutes.employees.update.method%>',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      // 응답 오류
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message || response.statusText);
      }

      // 응답 성공
      alertMessage('success', '<%=apiRoutes.employees.update.title%> 성공').then(() => {
        window.location.href = '<%=backendRoutes.employees.detail.url%>'.replace(':employeeId', '<%=data.id%>');
      });
    } catch (error) {
      toastMessage('error', error.message || '서버 오류가 발생했습니다.');
    }
  });
</script>
