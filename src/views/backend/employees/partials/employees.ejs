<div class="hidden space-y-4" id="employees-container">
  <div class="flex w-full items-center justify-between gap-2">
    <div class="flex gap-2">
      <input type="text" id="employees-query" class="orb-input lg:max-w-[200px]" placeholder="검색어를 입력해주세요." />
      <button id="btn-employees-search" class="orb-btn orb-btn-primary">조회</button>
    </div>
    <div class="flex items-center justify-end">
      <a href="<%=backendRoutes.employees.regist.url%>" class="orb-btn orb-btn-primary">관리자 등록</a>
    </div>
  </div>
  <!-- 관리자 목록 -->
  <div id="employees" class="flex overflow-x-auto"></div>
</div>

<script nonce="<%=nonce%>">
  document.addEventListener('DOMContentLoaded', () => {
    const employees = document.getElementById('employees');

    let currentGrid = null;

    const initGrid = async () => {
      // 기존 grid 초기화
      currentGrid?.destroy();

      const query = document.getElementById('employees-query').value;

      const params = new URLSearchParams({
        query,
      });

      // gridjs 인스턴스 생성
      currentGrid = new gridjs.Grid({
        columns: [
          { name: '번호' },
          {
            name: '아이디',
            formatter: (cell, row) => {
              const adminId = row.cells[0].data;
              return gridjs.html(
                `<a href="/admin/employees/${adminId}" class="hover:underline decoration-gray-800">${cell}</a>`
              );
            },
          },
          {
            name: '이름',
            formatter: (cell, row) => {
              const adminId = row.cells[0].data;
              return gridjs.html(
                `<a href="/admin/employees/${adminId}" class="hover:underline decoration-gray-800">${cell}</a>`
              );
            },
          },
          { name: '생성일' },
          { name: '마지막 로그인' },
        ],
        language: gridLangKoKR,
        data: [],
        className: {
          container: 'custom-gridjs-container', // 커스텀 페이지네이션 있을 경우 컨테이너 클래스 추가
        },
        resizable: true,
        style: {
          table: { 'white-space': 'nowrap' },
        },
        sort: true,
        server: {
          url: `<%=apiRoutes.employees.list.url%>?${params.toString()}`,
          headers: {
            Authorization: `Bearer ${getCookie('accessToken')}`,
          },
          then: (data) => data.data.map((item) => [item.id, item.email, item.name, item.createdAt, item.lastLoginAt]),
          total: (data) => data.metadata.total,
        },
        pagination: {
          limit: 20,
          server: {
            url: (prev, page, limit) => {
              return `${prev}&page=${page}&pageSize=${limit}`;
            },
          },
        },
      });

      // gridjs 렌더링
      currentGrid.render(employees);
    };

    document.getElementById('btn-employees-search').addEventListener('click', () => {
      initGrid();
    });

    initGrid();
  });
</script>
